<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Movie Hub â€” Netflix Style</title>
<style>
  :root{
    --bg:#0b0b0b;
    --card:#141414;
    --accent:#e50914;
    --muted:#9a9a9a;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:#fff;
    font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  header{
    background:linear-gradient(90deg, rgba(229,9,20,1) 0%, rgba(180,9,20,1) 100%);
    padding:18px 20px;
    display:flex;
    align-items:center;
    gap:16px;
  }
  header h1{margin:0;font-size:20px;letter-spacing:0.5px}

  .topbar{
    padding:18px 20px;
    display:flex;
    justify-content:center;
    background:transparent;
  }
  .search{
    width:100%;
    max-width:920px;
  }
  .search input{
    width:100%;
    padding:12px 14px;
    border-radius:8px;
    border:0;
    outline:0;
    font-size:15px;
    background:#111;
    color:#eee;
    box-shadow:0 2px 6px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  }

  main{padding:18px 8px 90px;} /* bottom padding for player space */
  .category-section{margin:18px 0 36px; padding-left:20px; padding-right:8px;}
  .category-title{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:12px;
  }
  .category-title h2{
    margin:0;
    font-size:18px;
    letter-spacing:0.2px;
  }
  .category-title p{margin:0;color:var(--muted);font-size:13px}

  .category-row{
    display:flex;
    gap:14px;
    overflow-x:auto;
    padding-bottom:6px;
    scroll-behavior:smooth;
  }
  .category-row::-webkit-scrollbar{height:10px}
  .category-row::-webkit-scrollbar-thumb{background:#222;border-radius:999px}

  .movie-card{
    background:var(--card);
    min-width:150px;
    width:150px;
    border-radius:8px;
    overflow:hidden;
    box-shadow:0 6px 16px rgba(0,0,0,0.6);
    transition:transform .18s ease, box-shadow .18s ease;
    cursor:pointer;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .movie-card.featured{
    min-width:260px;
    width:260px;
  }
  .poster{
    width:100%;
    height:220px;
    background:#222 center/cover no-repeat;
    display:block;
  }
  .meta{
    padding:8px 10px 12px;
    width:100%;
    text-align:center;
  }
  .meta h3{margin:0;font-size:14px;line-height:1.1}
  .meta span{display:block;color:var(--muted);font-size:12px;margin-top:6px}

  .movie-card:hover{transform:translateY(-6px);box-shadow:0 14px 30px rgba(0,0,0,0.7)}

  /* player modal */
  #playerModal{
    display:none;
    position:fixed;
    inset:0;
    z-index:1200;
    background:rgba(0,0,0,0.86);
    align-items:center;
    justify-content:center;
    padding:18px;
  }
  #playerModal .inner{
    width:100%;
    max-width:980px;
  }
  video{
    width:100%;
    border-radius:8px;
    background:#000;
  }
  .controls{
    margin-top:10px;
    display:flex;
    gap:10px;
    justify-content:flex-end;
  }
  .btn{
    background:var(--accent);
    border:0;color:#fff;padding:10px 14px;border-radius:6px;cursor:pointer;font-weight:600;
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}

  /* responsive */
  @media (max-width:720px){
    .movie-card{min-width:130px;width:130px}
    .movie-card.featured{min-width:190px;width:190px}
    .poster{height:180px}
  }
</style>
</head>
<body>
  <header>
    <h1>ðŸŽ¬ Movie Hub</h1>
  </header>

  <div class="topbar">
    <div class="search">
      <input id="searchInput" placeholder="Search movies, e.g. night, popeye, astro..." />
    </div>
  </div>

  <main id="mainContent">
    <!-- categories will render here -->
  </main>

  <!-- Player modal -->
  <div id="playerModal" role="dialog" aria-hidden="true">
    <div class="inner">
      <video id="videoPlayer" controls></video>
      <div class="controls">
        <button class="btn ghost" onclick="closePlayer()">Close</button>
      </div>
    </div>
  </div>

<script>
/*
  Netflix-style renderer:
  - Fetches movies.json from same folder (use "movies.json" in repo root)
  - Renders each category as a horizontal row with heading on top
  - First item in each row is 'featured' (larger)
  - Clicking any poster opens the player modal and plays the stream_url
  - Search filters cards and hides category if no visible items
*/

const apiUrl = "movies.json"; // keep movies.json in repo root
let allData = null;

async function init(){
  try{
    const res = await fetch(apiUrl);
    if(!res.ok) throw new Error('Could not fetch movies.json â€” check path/permission');
    allData = await res.json();
    renderAllCategories(allData.categories || []);
    setupSearch();
  }catch(err){
    console.error(err);
    document.getElementById('mainContent').innerHTML =
      `<p style="text-align:center;color:#f66;margin-top:40px">Failed to load movie data. Check <code>movies.json</code> is in the repo root and publicly accessible.</p>`;
  }
}

function renderAllCategories(categories){
  const container = document.getElementById('mainContent');
  container.innerHTML = '';
  categories.forEach(category => {
    const section = document.createElement('section');
    section.className = 'category-section';
    section.dataset.category = category.name;

    const titleRow = document.createElement('div');
    titleRow.className = 'category-title';
    const h2 = document.createElement('h2');
    h2.textContent = category.name;
    const info = document.createElement('p');
    info.textContent = `${category.movies.length} titles`;
    titleRow.appendChild(h2);
    titleRow.appendChild(info);

    const row = document.createElement('div');
    row.className = 'category-row';
    row.setAttribute('aria-label', category.name);

    // render movies; first one featured
    category.movies.forEach((movie, idx) => {
      const card = document.createElement('article');
      card.className = 'movie-card' + (idx === 0 ? ' featured' : '');
      card.tabIndex = 0; // keyboard access

      const poster = document.createElement('div');
      poster.className = 'poster';
      // set background image safely
      poster.style.backgroundImage = `url('${movie.thumbnail}')`;

      const meta = document.createElement('div');
      meta.className = 'meta';
      const t = document.createElement('h3');
      t.textContent = movie.title;
      const s = document.createElement('span');
      s.textContent = movie.year || '';

      meta.appendChild(t); meta.appendChild(s);

      card.appendChild(poster);
      card.appendChild(meta);

      // click to play
      card.addEventListener('click', () => {
        playMovie(movie.stream_url);
      });
      // allow Enter key to play
      card.addEventListener('keydown', (e) => {
        if(e.key === 'Enter') playMovie(movie.stream_url);
      });

      row.appendChild(card);
    });

    section.appendChild(titleRow);
    section.appendChild(row);
    container.appendChild(section);
  });
}

// Search: hide non-matching cards and hide sections with zero matches
function setupSearch(){
  const input = document.getElementById('searchInput');
  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    const sections = document.querySelectorAll('.category-section');
    sections.forEach(section => {
      const cards = section.querySelectorAll('.movie-card');
      let visibleCount = 0;
      cards.forEach(card => {
        const title = card.querySelector('.meta h3').textContent.toLowerCase();
        if(!q || title.includes(q)){
          card.style.display = '';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
      // show/hide whole section
      section.style.display = visibleCount > 0 ? '' : 'none';
    });
  });
}

// Player modal functions
function playMovie(url){
  const modal = document.getElementById('playerModal');
  const player = document.getElementById('videoPlayer');
  player.src = url;
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');
  player.play().catch(()=>{/* autoplay may be blocked by browser, user needs to press play */});
}
function closePlayer(){
  const modal = document.getElementById('playerModal');
  const player = document.getElementById('videoPlayer');
  player.pause();
  player.src = '';
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden','true');
}

init();
</script>
</body>
</html>
