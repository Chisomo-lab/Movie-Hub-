<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Hub Pro</title>
<style>
body { font-family: Arial,sans-serif; background:#111; color:#fff; margin:0; padding:0; }
header { background:#e50914; padding:15px; text-align:center; font-size:28px; font-weight:bold; position:sticky; top:0; z-index:1000; }
nav { display:flex; overflow-x:auto; background:#000; padding:10px; position:sticky; top:55px; z-index:999; }
nav a { display:flex; flex-direction:column; align-items:center; margin:0 10px; text-decoration:none; color:#fff; font-weight:bold; min-width:70px; }
nav img { width:50px; height:50px; border-radius:5px; object-fit:cover; margin-bottom:5px; }
nav a:hover { color:#e50914; transform:scale(1.1); transition:0.3s; }
.category { margin:20px; }
.category h2 { border-left:5px solid #e50914; padding-left:10px; margin-bottom:10px; cursor:pointer; }
.movies { display:flex; overflow-x:auto; gap:15px; padding:10px 0; scroll-behavior:smooth; }
.movie-card { background:#222; border-radius:10px; min-width:180px; flex:0 0 auto; padding:10px; text-align:center; transition:0.3s; }
.movie-card:hover { transform:scale(1.05); box-shadow:0 0 15px #e50914; }
.movie-card img { width:100%; height:250px; object-fit:cover; border-radius:8px; }
.movie-card h3 { font-size:14px; margin:10px 0 5px; }
.movie-card a { display:inline-block; margin:5px; padding:5px 10px; background:#e50914; color:#fff; border-radius:5px; text-decoration:none; font-size:12px; cursor:pointer; }
.movie-card a:hover { background:#b00610; }
.load-more { margin:10px; padding:8px 15px; background:#e50914; border:none; border-radius:5px; cursor:pointer; color:#fff; }
.load-more:hover { background:#b00610; }
@media(max-width:600px){ .movie-card { min-width:140px; } nav img { width:40px; height:40px; } }
</style>
</head>
<body>

<header>ðŸŽ¬ Movie Hub Pro</header>
<nav id="navbar"></nav>
<div id="content"></div>

<script>
// Multiple collections per category
const categories = {
  "action": { collections:["feature_films","action"], thumb:"https://archive.org/services/img/feature_films" },
  "comedy": { collections:["comedy","comedy_classics"], thumb:"https://archive.org/services/img/comedy" },
  "horror": { collections:["horror","classic_horror"], thumb:"https://archive.org/services/img/horror" },
  "animation": { collections:["animationandcartoons","cartoons","classic_animation"], thumb:"https://archive.org/services/img/animationandcartoons" },
  "anime": { collections:["anime","anime_classics"], thumb:"https://archive.org/services/img/anime" },
  "sci-fi": { collections:["sciencefiction","scifi_classics"], thumb:"https://archive.org/services/img/sciencefiction" }
};

const rowsPerLoad = 24;
let loadedCounts = {};
let collectionIndex = {}; // Track which collection we are loading for each category

// Build navbar
const nav = document.getElementById("navbar");
Object.entries(categories).forEach(([cat, data])=>{
  const a = document.createElement("a");
  a.href = `#${cat}`;
  a.innerHTML = `<img src="${data.thumb}" onerror="this.src='https://via.placeholder.com/50x50?text=?'"><span>${cat.toUpperCase()}</span>`;
  a.onclick=()=>loadCategory(cat);
  nav.appendChild(a);
});

// Fetch movies from a single collection
async function fetchMovies(collection, start=0, rows=24){
  const url = `https://archive.org/advancedsearch.php?q=collection:(${collection})+AND+mediatype:(movies)&fl[]=identifier&fl[]=title&fl[]=year&sort[]=downloads desc&output=json&rows=${rows}&start=${start}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    return data.response.docs || [];
  } catch(e){ console.log('Fetch error:',e); return []; }
}

// Create movie card
function createMovieCard(movie){
  const card = document.createElement("div");
  card.className="movie-card";
  const identifier = movie.identifier;
  const streamPageUrl = `https://archive.org/details/${identifier}`;
  const downloadUrl = `https://archive.org/download/${identifier}/${identifier}.mp4`;

  card.innerHTML = `
    <img src="https://archive.org/services/img/${identifier}" alt="${movie.title}" onerror="this.src='https://via.placeholder.com/180x250?text=No+Image'">
    <h3>${movie.title || "Untitled"} (${movie.year || "N/A"})</h3>
    <a href="${streamPageUrl}" target="_blank">Stream</a>
    <a href="${downloadUrl}" target="_blank">Download</a>
  `;
  return card;
}

// Load category (with multiple collections)
async function loadCategory(catId){
  const catData = categories[catId];
  if(!collectionIndex[catId]) collectionIndex[catId]=0;
  const colIdx = collectionIndex[catId];
  const collection = catData.collections[colIdx];

  const start = loadedCounts[catId] || 0;
  const movies = await fetchMovies(collection, start, rowsPerLoad);
  loadedCounts[catId] = start + movies.length;

  let categoryDiv = document.getElementById(catId);
  if(!categoryDiv){
    categoryDiv = document.createElement("div");
    categoryDiv.className="category";
    categoryDiv.id=catId;

    const title = document.createElement("h2");
    title.textContent = catId.toUpperCase();
    title.onclick=()=>{
      const moviesDiv = categoryDiv.querySelector(".movies");
      moviesDiv.style.display = moviesDiv.style.display==="none"?"flex":"none";
    };
    categoryDiv.appendChild(title);

    const moviesDiv = document.createElement("div");
    moviesDiv.className="movies";
    categoryDiv.appendChild(moviesDiv);

    const loadBtn = document.createElement("button");
    loadBtn.textContent="Load More";
    loadBtn.className="load-more";
    loadBtn.onclick=()=>loadCategory(catId);
    categoryDiv.appendChild(loadBtn);

    document.getElementById("content").appendChild(categoryDiv);
  }

  const moviesDiv = categoryDiv.querySelector(".movies");

  // If no movies and more collections left, move to next collection
  if(movies.length===0){
    if(colIdx+1 < catData.collections.length){
      collectionIndex[catId] = colIdx+1;
      loadedCounts[catId]=0;
      loadCategory(catId);
      return;
    } else if(start===0){
      moviesDiv.innerHTML="<p style='color:#aaa'>No movies found in this category.</p>";
      return;
    }
  }

  movies.forEach(movie=>{
    const card = createMovieCard(movie);
    moviesDiv.appendChild(card);
  });
}

// Initial load
Object.keys(categories).forEach(cat=>{
  loadedCounts[cat]=0;
  collectionIndex[cat]=0;
  loadCategory(cat);
});
</script>
</body>
</html>
